<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ë‹´ë§ˆë£¨ ì¶œì„ ì²´í¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        '2xl': '1536px',
                        '3xl': '1920px',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .btn-secondary {
            background-color: #ef4444; /* red-500 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #dc2626; /* red-600 */
        }
        .btn-text-delete {
            color: #ef4444; /* red-500 */
        }
        .btn-text-delete:hover {
            text-decoration: underline;
        }
        /* Custom styles for circular button */
        .circular-btn {
            width: 48px; /* w-12, Adjusted for smaller grid */
            height: 48px; /* h-12, Adjusted for smaller grid */
            border-radius: 9999px; /* rounded-full */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600; /* font-semibold */
            font-size: 0.75rem; /* text-xs, Adjusted for smaller grid */
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            color: white; /* Text color for the button */
        }
        .circular-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }
        .circular-btn:disabled {
            background-color: #9ca3af; /* gray-400 for disabled state */
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-stone-100 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-full bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-4">
        
        <!-- Date Display Section -->
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 text-stone-600">
            <div class="text-center sm:text-left mb-2 sm:mb-0">
                <p class="font-bold text-green-500 text-[70px]">ë„ì„œ ëŒ€ì¶œì¼</p>
                <div id="current-date" class="font-medium text-green-500 text-3xl sm:text-4xl lg:text-[75px] leading-none"></div>
            </div>
            <div class="text-center sm:text-right">
                <p class="font-bold text-orange-500 text-[70px]">ë„ì„œ ë°˜ë‚©ì¼</p>
                <div id="two-weeks-later-date" class="font-medium text-orange-500 text-3xl sm:text-4xl lg:text-[75px] leading-none"></div>
            </div>
        </div>

        <!-- Separator Line -->
        <div class="h-px bg-stone-300 my-4"></div>

        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-stone-800">ë„ë‹´ë§ˆë£¨ ì¶œì„ ì²´í¬ ğŸ§‘â€ğŸ“</h1>
            <p class="text-stone-500 mt-2">ìê¸° ì´ë¦„ì„ ì°¾ì•„ í´ë¦­ í•´ ì£¼ì„¸ìš”!</p>
        </header>

        <!-- Student List -->
        <section class="space-y-4">
            <h2 class="text-lg font-semibold text-stone-700 mb-2">í•™ìƒ ëª©ë¡ (ì´ <span id="student-count">0</span>ëª…)</h2>
            <div id="student-list-container" class="bg-white border border-stone-200 rounded-lg p-3 shadow-sm grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-9 3xl:grid-cols-11 gap-x-2 gap-y-1">
                <p id="no-students-message" class="col-span-full text-center text-stone-400 mt-4 hidden">ì•„ì§ ë“±ë¡ëœ í•™ìƒì´ ì—†ì–´ìš”.</p>
                <!-- í•™ìƒ ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </section>

        <footer class="text-center pt-2 flex flex-row justify-center items-center gap-4">
            <button id="reset-all-button" class="text-sm btn-text-delete hover:underline">
                ëª¨ë“  í•™ìƒ ê¸°ë¡ ì´ˆê¸°í™”
            </button>
            <button id="view-all-history-button" class="px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700">
                ì „ì²´ í•™ìƒ ê¸°ë¡ ë³´ê¸°
            </button>
        </footer>

    </main>

    <!-- ëª¨ë“  í•™ìƒ ê¸°ë¡ ì´ˆê¸°í™” ì½”ë“œ ì…ë ¥ ëª¨ë‹¬ (ìµœì¢… í™•ì¸ ê¸°ëŠ¥ í†µí•©) -->
    <div id="code-reset-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h3 class="text-xl font-bold text-stone-800">ì •ë§ ëª¨ë“  í•™ìƒì„ ì´ˆê¸°í™”í•˜ì‹œê² ì–´ìš”?</h3>
            <p class="text-stone-500 mt-2 mb-4">ì´ˆê¸°í™”í•˜ë ¤ë©´ 4ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. <br>ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <input type="password" id="reset-code-input" class="w-full p-2 border-2 border-stone-300 rounded-md text-center text-lg tracking-widest focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="4">
            <p id="code-error-message" class="text-red-500 text-sm mt-2 hidden">ì˜¬ë°”ë¥¸ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <div class="flex justify-center gap-4 mt-6">
                <button id="confirm-code-button" class="px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700">í™•ì¸</button>
                <button id="cancel-code-button" class="px-6 py-2 rounded-lg font-semibold bg-stone-200 text-stone-700 hover:bg-stone-300">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì •ë³´ ë©”ì‹œì§€ ëª¨ë‹¬ (ì˜ˆ: 40ëª… ì œí•œ, ì´ë¦„ ì¤‘ë³µ) -->
    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h3 id="info-modal-title" class="text-xl font-bold text-stone-800">ì•Œë¦¼</h3>
            <p id="info-modal-text" class="text-stone-500 mt-2 mb-6">[ë©”ì‹œì§€ ë‚´ìš©]</p>
            <button id="close-info-modal-button" class="px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white">í™•ì¸</button>
        </div>
    </div>

    <!-- í•™ìƒ ì „ì²´ ì¶œì„ ê¸°ë¡ ë§‰ëŒ€ ê·¸ë˜í”„ ëª¨ë‹¬ -->
    <div id="all-history-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-4xl text-center">
            <h3 id="all-history-modal-title" class="text-xl font-bold text-stone-800 mb-4">ì „ì²´ í•™ìƒ ì´ë²ˆ ë‹¬ ì¶œì„ ê¸°ë¡</h3>
            <div class="w-full h-[50vh] bg-stone-50 border border-stone-200 rounded-lg p-3">
                <canvas id="attendance-chart"></canvas>
            </div>
            <button id="close-all-history-modal-button" class="mt-6 px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const studentListContainer = document.getElementById('student-list-container');
            const studentCountSpan = document.getElementById('student-count');
            const noStudentsMessage = document.getElementById('no-students-message');
            const resetAllButton = document.getElementById('reset-all-button');
            const viewAllHistoryButton = document.getElementById('view-all-history-button');

            const codeResetModal = document.getElementById('code-reset-modal');
            const resetCodeInput = document.getElementById('reset-code-input');
            const confirmCodeButton = document.getElementById('confirm-code-button');
            const cancelCodeButton = document.getElementById('cancel-code-button');
            const codeErrorMessage = document.getElementById('code-error-message');

            const infoModal = document.getElementById('info-modal');
            const infoModalTitle = document.getElementById('info-modal-title');
            const infoModalText = document.getElementById('info-modal-text');
            const closeInfoModalButton = document.getElementById('close-info-modal-button');
            
            const allHistoryModal = document.getElementById('all-history-modal');
            const closeAllHistoryModalButton = document.getElementById('close-all-history-modal-button');
            const attendanceChartCanvas = document.getElementById('attendance-chart');

            const currentDateEl = document.getElementById('current-date');
            const twoWeeksLaterDateEl = document.getElementById('two-weeks-later-date');

            let students = {};
            let studentOrder = [];
            let draggedStudentName = null;
            let myChart = null; // Chart.js ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜

            const fixedStudentNames = [
                'ì •í•´ë‚˜', 'ì›ì†Œì •', 'ìš°ì°¬ì˜', 'ì „ì œì¤€', 'ê°•í•œë´„', 'ì´ê¸°ì›…', 'ìš©í•´ì¸', 'ì´íš¨ìœ¨',
                'ì¥ì„¤', 'ì´í•˜ìœ¤', 'ê³½ì¬ì€', 'ê¹€íƒœì´', 'ê°•ì‹œí˜¸', 'ì •ëª¨ì„¸', 'ê¹€ë„í¬', 'ê¹€ë¼ì—˜',
                'ì´ê¸°ë°±', 'ì´ê±´ìš°', 'ê¹€ë‹¤ì¸', 'ê¹€ë„ì¤€', 'ì‹ ì§€ìš°', 'í•œì¬ì´', 'ì‹ ìˆ˜ë¹ˆ', 'ë°•ì§€ìœ ',
                'ê¶Œë„ì—°', 'ìš°ì˜ˆë¹ˆ', 'ê¹€ë„í›ˆ', 'ì°¨íƒœí˜¸', 'ë°•ê²½ë¯¼', 'ê¶Œë‚˜ìœ¤', 'ê°•í•œì•„'
            ];

            const studentCardColors = [
                'bg-blue-50', 'bg-green-50', 'bg-yellow-50', 'bg-red-50',
                'bg-purple-50', 'bg-pink-50', 'bg-indigo-50', 'bg-teal-50',
            ];

            const circularButtonColors = [
                'bg-blue-600', 'bg-green-600', 'bg-yellow-600', 'bg-red-600',
                'bg-purple-600', 'bg-pink-600', 'bg-indigo-600', 'bg-teal-600',
            ];

            const getFormattedDateString = (date, includeYear = true, includeTime = false) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const dayOfWeek = daysOfWeek[date.getDay()];
                
                let dateString = '';
                if (includeYear) {
                    dateString += `${year}ë…„ `;
                }
                dateString += `${month}ì›” ${day}ì¼ (${dayOfWeek})`;

                if (includeTime) {
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    const seconds = String(date.getSeconds()).padStart(2, '0');
                    dateString += ` ${hours}ì‹œ ${minutes}ë¶„ ${seconds}ì´ˆ`;
                }
                return dateString;
            };

            const getReturnDate = () => {
                let date = new Date();
                date.setDate(date.getDate() + 14);

                let dayOfWeek = date.getDay();
                if (dayOfWeek === 0) {
                    date.setDate(date.getDate() + 1);
                } else if (dayOfWeek === 6) {
                    date.setDate(date.getDate() + 2);
                }
                return getFormattedDateString(date, false);
            };

            const loadData = () => {
                const savedData = localStorage.getItem('attendanceAppStudents');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    students = parsedData.students || {};
                    studentOrder = parsedData.studentOrder || [...fixedStudentNames];
                } else {
                    studentOrder = [...fixedStudentNames];
                    fixedStudentNames.forEach(name => {
                        students[name] = { attendanceDates: [] };
                    });
                }
                const currentStudentNamesInOrder = new Set(studentOrder);
                const studentsToDelete = Object.keys(students).filter(name => !currentStudentNamesInOrder.has(name));
                studentsToDelete.forEach(name => delete students[name]);

                fixedStudentNames.forEach(name => {
                    if (!students[name]) {
                        students[name] = { attendanceDates: [] };
                    }
                });
                studentOrder = studentOrder.filter(name => fixedStudentNames.includes(name));
                fixedStudentNames.forEach(name => {
                    if (!studentOrder.includes(name)) {
                        studentOrder.push(name);
                    }
                });
            };

            const saveData = () => {
                const dataToSave = {
                    students: students,
                    studentOrder: studentOrder,
                };
                localStorage.setItem('attendanceAppStudents', JSON.stringify(dataToSave));
            };

            const showInfoModal = (title, message) => {
                infoModalTitle.textContent = title;
                infoModalText.textContent = message;
                infoModal.classList.remove('hidden');
            };

            const renderStudents = () => {
                studentListContainer.innerHTML = '';
                studentCountSpan.textContent = studentOrder.length;

                if (studentOrder.length === 0) {
                    noStudentsMessage.classList.remove('hidden');
                    noStudentsMessage.className = 'col-span-full text-center text-stone-400 mt-4';
                    studentListContainer.appendChild(noStudentsMessage);
                } else {
                    noStudentsMessage.classList.add('hidden');
                }

                const currentMonthYear = new Date().getFullYear() + 'ë…„ ' + String(new Date().getMonth() + 1).padStart(2, '0') + 'ì›”';
                
                const monthlyAttendanceCounts = studentOrder.map(studentName => {
                    const student = students[studentName];
                    const uniqueMonthlyAttendanceDates = new Set(
                        student.attendanceDates
                            .filter(date => date.startsWith(currentMonthYear))
                            .map(date => date.split(' (')[0])
                    );
                    return { name: studentName, count: uniqueMonthlyAttendanceDates.size };
                });

                monthlyAttendanceCounts.sort((a, b) => b.count - a.count);

                let top3Students = new Set();
                if (monthlyAttendanceCounts.length > 0) {
                    top3Students.add(monthlyAttendanceCounts[0].name);
                    if (monthlyAttendanceCounts.length > 1 && monthlyAttendanceCounts[1].count === monthlyAttendanceCounts[0].count) {
                        top3Students.add(monthlyAttendanceCounts[1].name);
                    } else if (monthlyAttendanceCounts.length > 1) {
                        top3Students.add(monthlyAttendanceCounts[1].name);
                    }
                    if (monthlyAttendanceCounts.length > 2 && monthlyAttendanceCounts[2].count === monthlyAttendanceCounts[1].count) {
                        top3Students.add(monthlyAttendanceCounts[2].name);
                    } else if (monthlyAttendanceCounts.length > 2 && monthlyAttendanceCounts[2].count === monthlyAttendanceCounts[0].count) {
                         top3Students.add(monthlyAttendanceCounts[2].name);
                    } else if (monthlyAttendanceCounts.length > 2 && monthlyAttendanceCounts[2].count < monthlyAttendanceCounts[1].count) {
                        top3Students.add(monthlyAttendanceCounts[2].name);
                    }
                }
                
                studentOrder.forEach((studentName, index) => {
                    const student = students[studentName];
                    if (!student) {
                        students[studentName] = { attendanceDates: [] };
                    }

                    const uniqueMonthlyAttendanceDates = new Set(
                        student.attendanceDates
                            .filter(date => date.startsWith(currentMonthYear))
                            .map(date => date.split(' (')[0])
                    );
                    const attendedCount = uniqueMonthlyAttendanceDates.size; 

                    const todayDateOnly = getFormattedDateString(new Date(), true, false).split(' (')[0];
                    const hasAttendedToday = student.attendanceDates.some(date => date.startsWith(todayDateOnly));

                    const cardColorClass = studentCardColors[index % studentCardColors.length];
                    const buttonColorClass = circularButtonColors[index % circularButtonColors.length];

                    const isTopStudent = top3Students.has(studentName);
                    const crownIcon = isTopStudent ? ' ğŸ‘‘' : '';

                    const studentCard = document.createElement('div');
                    studentCard.className = `${cardColorClass} p-2 rounded-lg border border-stone-200 shadow-sm flex flex-col items-center justify-between cursor-grab`;
                    studentCard.setAttribute('data-student-name', studentName);
                    studentCard.setAttribute('draggable', 'true');

                    studentCard.innerHTML = `
                        <div class="flex items-center justify-between w-full mb-3">
                            <h3 class="text-2xl font-semibold text-stone-800 truncate pr-2">${studentName}${crownIcon}</h3>
                        </div>
                        <div class="flex flex-col items-center space-y-2">
                            <button class="circular-btn attend-btn ${hasAttendedToday ? 'bg-gray-400 cursor-not-allowed' : buttonColorClass}" ${hasAttendedToday ? 'disabled' : ''} data-student-name="${studentName}">
                                ${hasAttendedToday ? 'ì™„ë£Œ! ğŸ‰' : 'ì¶œì„'}
                            </button>
                            <div class="text-center text-base mt-2">
                                <p class="text-stone-500 text-sm">ì´ë²ˆ ë‹¬ ì¶œì„ íšŸìˆ˜</p>
                                <p class="text-xl font-bold text-blue-600">${attendedCount}íšŒ</p>
                                ${hasAttendedToday ? `<button class="text-sm text-blue-500 hover:text-blue-700 hover:underline undo-attend-btn mt-1" data-student-name="${studentName}">ë˜ëŒë¦¬ê¸°</button>` : ''}
                            </div>
                        </div>
                    `;
                    studentListContainer.appendChild(studentCard);
                });

                attachStudentButtonListeners();
                attachDragAndDropListeners();
            };

            const attachStudentButtonListeners = () => {
                document.querySelectorAll('.attend-btn').forEach(button => {
                    button.onclick = (event) => {
                        const studentName = event.target.dataset.studentName;
                        const fullTodayStrWithTime = getFormattedDateString(new Date(), true, true);
                        const todayDateOnly = getFormattedDateString(new Date(), true, false).split(' (')[0];
                        
                        if (students[studentName]) {
                            const hasAttendedToday = students[studentName].attendanceDates.some(date => date.startsWith(todayDateOnly));

                            if (hasAttendedToday) {
                                showInfoModal('ì´ë¯¸ ì¶œì„ ì™„ë£Œ', 'ì´ í•™ìƒì€ ì˜¤ëŠ˜ ì´ë¯¸ ì¶œì„í–ˆìŠµë‹ˆë‹¤.');
                                return;
                            }

                            students[studentName].attendanceDates.push(fullTodayStrWithTime);
                            saveData();
                            renderStudents();
                        }
                    };
                });
                
                document.querySelectorAll('.undo-attend-btn').forEach(button => {
                    button.onclick = (event) => {
                        const studentName = event.target.dataset.studentName;
                        const todayDateOnly = getFormattedDateString(new Date(), true, false).split(' (')[0];

                        if (students[studentName]) {
                            let lastIndex = -1;
                            for (let i = students[studentName].attendanceDates.length - 1; i >= 0; i--) {
                                if (students[studentName].attendanceDates[i].startsWith(todayDateOnly)) {
                                    lastIndex = i;
                                    break;
                                }
                            }
                            
                            if (lastIndex > -1) {
                                students[studentName].attendanceDates.splice(lastIndex, 1);
                                saveData();
                                renderStudents();
                            }
                        }
                    };
                });
            };

            const attachDragAndDropListeners = () => {
                const studentCards = studentListContainer.querySelectorAll('[draggable="true"]');

                studentCards.forEach(card => {
                    card.addEventListener('dragstart', (e) => {
                        draggedStudentName = card.dataset.studentName;
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', draggedStudentName);
                        setTimeout(() => {
                            card.classList.add('opacity-50', 'border-dashed', 'border-blue-500');
                        }, 0);
                    });

                    card.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        const targetCard = e.currentTarget;
                        if (draggedStudentName !== targetCard.dataset.studentName) {
                            targetCard.classList.add('border-2', 'border-blue-300', 'scale-105');
                        }
                    });

                    card.addEventListener('dragleave', (e) => {
                        e.currentTarget.classList.remove('border-2', 'border-blue-300', 'scale-105');
                    });

                    card.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const droppedOnStudentName = e.currentTarget.dataset.studentName;

                        if (draggedStudentName && droppedOnStudentName && draggedStudentName !== droppedOnStudentName) {
                            const fromIndex = studentOrder.indexOf(draggedStudentName);
                            const toIndex = studentOrder.indexOf(droppedOnStudentName);

                            if (fromIndex > -1 && toIndex > -1) {
                                const [movedItem] = studentOrder.splice(fromIndex, 1);
                                studentOrder.splice(toIndex, 0, movedItem);
                                saveData();
                                renderStudents();
                            }
                        }
                    });

                    card.addEventListener('dragend', (e) => {
                        studentCards.forEach(c => c.classList.remove('opacity-50', 'border-dashed', 'border-blue-500', 'border-2', 'border-blue-300', 'scale-105'));
                        draggedStudentName = null;
                    });
                });
            };
            
            const renderChart = () => {
                const currentMonthYear = new Date().getFullYear() + 'ë…„ ' + String(new Date().getMonth() + 1).padStart(2, '0') + 'ì›”';
                const chartData = studentOrder.map(name => {
                    const student = students[name];
                    const uniqueMonthlyAttendanceDates = new Set(
                        student.attendanceDates
                            .filter(date => date.startsWith(currentMonthYear))
                            .map(date => date.split(' (')[0])
                    );
                    return {
                        name: name,
                        count: uniqueMonthlyAttendanceDates.size
                    };
                }).sort((a, b) => b.count - a.count);

                const labels = chartData.map(d => d.name);
                const data = chartData.map(d => d.count);
                const backgroundColors = data.map((count, index) => {
                    const studentIndex = studentOrder.indexOf(chartData[index].name);
                    const colorClass = circularButtonColors[studentIndex % circularButtonColors.length];
                    return colorClass.replace('bg-', '#').replace('600', '700'); // Use a slightly darker color for the bar
                });
                
                if (myChart) {
                    myChart.destroy();
                }

                myChart = new Chart(attendanceChartCanvas, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ì´ë²ˆ ë‹¬ ì¶œì„ íšŸìˆ˜',
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: backgroundColors.map(color => color.replace('700', '800')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'ì´ë²ˆ ë‹¬ í•™ìƒ ì¶œì„ ê¸°ë¡',
                                font: {
                                    size: 16
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ì¶œì„ íšŸìˆ˜'
                                }
                            }
                        }
                    }
                });
            };

            // Event Listeners
            resetAllButton.addEventListener('click', () => {
                codeResetModal.classList.remove('hidden');
                resetCodeInput.value = '';
                codeErrorMessage.classList.add('hidden');
            });

            confirmCodeButton.addEventListener('click', () => {
                const enteredCode = resetCodeInput.value;
                if (enteredCode === '6408') {
                    students = {};
                    studentOrder = [...fixedStudentNames];
                    fixedStudentNames.forEach(name => {
                        students[name] = { attendanceDates: [] };
                    });
                    saveData();
                    renderStudents();
                    codeResetModal.classList.add('hidden');
                } else {
                    codeErrorMessage.classList.remove('hidden');
                    resetCodeInput.value = '';
                }
            });

            cancelCodeButton.addEventListener('click', () => {
                codeResetModal.classList.add('hidden');
            });

            closeInfoModalButton.addEventListener('click', () => {
                infoModal.classList.add('hidden');
            });

            viewAllHistoryButton.addEventListener('click', () => {
                allHistoryModal.classList.remove('hidden');
                renderChart();
            });

            closeAllHistoryModalButton.addEventListener('click', () => {
                allHistoryModal.classList.add('hidden');
            });

            currentDateEl.textContent = getFormattedDateString(new Date(), false);
            twoWeeksLaterDateEl.textContent = getReturnDate();

            loadData();
            renderStudents();
        });
    </script>
</body>
</html>

